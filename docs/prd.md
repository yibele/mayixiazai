# 蚂蚁下载 - 小程序需求文档 (PRD) v1.2

## 1. 项目概述

本项目旨在开发一款名为“蚂蚁下载”的微信小程序。核心功能是为用户提供主流自媒体平台（抖音、快手、小红书、B站）的视频解析、无水印下载及文案提取服务。小程序将通过广告和增值服务（积分系统）实现盈利。

## 2. 核心功能详述

### 2.1 功能一：视频无水印解析与下载

-   **目标**：用户输入单个视频的分享链接，快速获取并下载无水印的视频文件。
-   **支持平台**：抖音、快手、小红书、Bilibili。
-   **输入与解析流程**：
    1.  用户通过**手动粘贴**或**剪贴板自动识别**功能输入链接，点击“开始分析”。
    2.  前端显示“正在解析中...”状态，并调用后端服务。
    3.  解析成功后，在界面上展示视频封面、标题、作者等信息。
-   **核心操作**：
    -   提供一个明确的 **“下载视频”** 按钮。
    -   用户点击后，申请相册写入权限，并将无水印视频保存到用户手机相册。
-   **异常处理**：
    -   链接无效/格式错误：提示“链接格式不正确，请重新复制”。
    -   视频不存在/私密：提示“无法解析该视频，可能已被删除或设为私密”。
    -   解析超时/失败：提示“解析失败，请稍后再试”。

### 2.2 功能二：视频文案提取

-   **目标**：在视频解析成功后，为用户提供一键复制视频原始文案的功能。
-   **流程**：
    1.  此功能与“视频下载”共享同一次解析结果。
    2.  在视频解析成功后的结果页面，提供一个独立的 **“复制文案”** 按钮。
    3.  用户点击后，即可将视频的完整文案复制到剪贴板，并提示“已复制”。

### 2.3 功能三：批量分析

-   **目标**：输入某用户的主页链接，获取其发布的所有公开视频列表，并支持批量下载。
-   **定位**：此功能为高级功能，需要通过积分兑换使用次数。
-   **交互设计**：
    1.  用户输入主页链接，点击分析。
    2.  采用**分页加载**机制，默认加载最新的20个视频，用户上滑时加载更多。
    3.  每个视频条目旁都有一个复选框，用户可以勾选需要下载的视频。
    4.  提供“全选”和“开始下载”按钮。
-   **下载机制**：点击“开始下载”后，逐一处理勾选的视频，并显示总体下载进度（例如：“正在下载... 第 3/10 个”）。

### 2.4 功能四：任务与积分系统

-   **目标**：建立经济闭环，激励用户赚取积分，并使用积分消费高级功能。
-   **积分的价值（出口）**：
    1.  **兑换高级功能**：消耗积分来使用“批量分析”功能。例如：每次批量分析消耗50积分。
    2.  **兑换下载次数**：每日提供N次免费解析，超出后需用积分兑换次数。例如：10积分兑换1次解析。
-   **任务列表（入口）**：
    1.  **观看激励广告**：每次观看完广告获得10积分，每日上限5次。
    2.  **邀请好友**：用户分享小程序给好友，好友成功使用一次解析功能后，邀请者获得20积分。

### 2.5 功能五：用户系统

-   **目标**：记录和管理用户的核心数据。
-   **登录**：通过微信授权静默登录，获取 `openid` 作为唯一用户标识。
-   **数据存储**：在云数据库中为每个用户记录：`openid` (主键)、积分余额、每日免费解析已使用次数、累计完成任务次数。
-   **用户界面**：在“我的”页面，向用户展示其积分余额和使用历史。

## 3. 技术架构

-   **前端**：原生微信小程序。
-   **后端**：**微信云开发**，使用其云函数和云数据库。
-   **核心API服务**：Coze。
-   **【重要】API 调用方式**：
    -   **严禁在小程序前端直接请求 Coze API**。
    -   **正确架构**：`小程序前端 -> 调用云函数 -> 云函数请求 Coze API -> 云函数将结果返回给前端`。

## 4. 非功能性需求

-   **性能**：批量分析页面的列表加载速度应流畅，避免卡顿。
-   **安全**：API Key 等敏感信息必须存储在云函数等服务端环境中。
-   **用户体验**：所有操作都应有即时、清晰的状态反馈（加载中、成功、失败）。

## 5. 合规性说明

-   **视频版权**：小程序内需有明确提示：“本服务仅供个人学习与收藏，视频版权归原作者所有，请勿用于任何商业用途，否则后果自负。”
-   **平台规则**：任务系统设计需严格遵守微信小程序运营规范，避免被判定为“诱导分享”。
