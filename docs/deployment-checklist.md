# 🚀 部署检查清单

## ✅ 部署前检查

### 1. 云开发环境准备
- [ ] 已在微信云控制台创建云开发环境
- [ ] 已获取云环境 ID (可选，不填则使用默认环境)
- [ ] 云环境资源配置充足

### 2. 云函数准备
- [ ] `cloudfunctions/parseVideo/` 目录已创建
- [ ] `package.json` 配置正确
- [ ] `index.js` 代码已完成
- [ ] Coze API Token 已正确配置

### 3. 小程序配置
- [ ] `project.config.json` 已添加 `cloudfunctionRoot` 配置
- [ ] `app.ts` 已添加云开发初始化代码
- [ ] 前端代码已更新为调用云函数

## 🛠️ 部署步骤

### 步骤 1: 部署云函数
1. 打开微信开发者工具
2. 在左侧目录树中找到 `cloudfunctions/parseVideo`
3. 右键点击文件夹
4. 选择 **"上传并部署：云端安装依赖"**
5. 等待部署完成（通常需要1-2分钟）

### 步骤 2: 配置云环境（可选）
```typescript
// 在 app.ts 中配置环境 ID
wx.cloud.init({
  env: 'your-env-id', // 替换为你的环境 ID
  traceUser: true,
});
```

### 步骤 3: 测试功能
1. 在模拟器中测试视频解析功能
2. 使用真实的视频链接进行测试
3. 验证下载功能是否正常

## 🔍 部署后验证

### 功能测试
- [ ] 输入视频链接能正常解析
- [ ] 解析结果显示正确（标题、封面等）
- [ ] 下载功能正常工作
- [ ] 视频能成功保存到相册
- [ ] 错误提示正常显示

### 性能测试
- [ ] 解析速度在可接受范围内（< 10秒）
- [ ] 下载速度正常
- [ ] 内存使用正常

### 兼容性测试
- [ ] iOS 设备测试正常
- [ ] Android 设备测试正常
- [ ] 不同屏幕尺寸显示正常

## ⚠️ 常见问题排查

### 问题 1: 云函数调用失败
**症状**: 前端显示"网络错误，请稍后再试"

**排查步骤**:
1. 检查云函数是否正确部署
2. 在云控制台查看函数日志
3. 确认云环境 ID 配置正确

### 问题 2: API 调用失败
**症状**: 显示"解析失败，请检查链接或稍后再试"

**排查步骤**:
1. 检查 Coze API Token 是否有效
2. 验证 workflow_id 是否正确
3. 查看云函数日志中的具体错误信息

### 问题 3: 下载失败
**症状**: 下载按钮点击后无响应或提示下载失败

**排查步骤**:
1. 检查返回的视频 URL 是否有效
2. 测试网络连接是否正常
3. 验证相册权限是否授权

### 问题 4: 权限问题
**症状**: 保存视频时提示权限错误

**解决方案**:
1. 用户首次使用时会弹出权限请求
2. 如果用户拒绝，应引导用户到设置页面授权
3. 代码中已包含自动打开设置页面的逻辑

## 📊 监控指标

### 关键指标
- 云函数调用成功率: > 95%
- 平均响应时间: < 5 秒
- 下载成功率: > 90%
- 用户留存率: 监控用户重复使用情况

### 监控方式
1. **云控制台**: 查看云函数调用统计
2. **小程序后台**: 监控用户行为数据
3. **日志分析**: 定期分析错误日志

## 🔧 优化建议

### 性能优化
1. **缓存策略**: 相同链接避免重复解析
2. **并发控制**: 限制同时下载的视频数量
3. **资源清理**: 定期清理临时文件

### 用户体验优化
1. **进度提示**: 显示更详细的进度信息
2. **离线提示**: 网络异常时的友好提示
3. **快捷操作**: 支持长按复制、分享等操作

### 安全优化
1. **参数校验**: 加强输入参数的验证
2. **频率限制**: 防止恶意刷新调用
3. **日志脱敏**: 避免记录敏感信息

## 📝 维护说明

### 定期维护
- 每周检查云函数运行状态
- 每月分析使用数据和错误日志
- 每季度评估 API 配额使用情况

### 版本更新
- 保持依赖包的最新版本
- 关注微信小程序基础库更新
- 适配新的 API 变化

---

## 📞 技术支持

如果遇到无法解决的问题，请提供以下信息：
1. 具体的错误信息
2. 云函数日志截图
3. 测试用的视频链接
4. 设备信息和微信版本

**部署完成后，记得更新此清单的完成状态！** ✅